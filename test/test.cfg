process CALIBTEST  = {
  
    include "FWCore/MessageLogger/data/MessageLogger.cfi"

    untracked PSet options = {
        untracked bool wantSummary = true
    }
	
    #
    # Source
    #
    #include "Calibration/CalibTreeMaker/data/EmptyPoolSource.cfi"
    #include "Calibration/CalibTreeMaker/data/PhotonJets_Pt_20_30-CMSSW_1_5_2-CSA07-2177-GEN-SIM-DIGI-RECO.cfi"
    #untracked PSet maxEvents = {untracked int32 input = 100}
    #
    # PoolSource
    #
    include "Calibration/CalibTreeMaker/data/RelVal-RelValSinglePi.cfi"
    untracked PSet maxEvents = {untracked int32 input = -1}
 
    #-----------------------------------------------------------------
    # run isolation tool with calorimeter isolation
    include "PhysicsTools/IsolationAlgos/data/PhotonCalIsolation.cfi"
    replace photonCalIsolation.src = correctedPhotons
    replace photonCalIsolation.dRMin = 0.2
    replace photonCalIsolation.dRMax = 0.7
    replace photonCalIsolation.elements = towerMaker

    # run isolation tool with calorimeter isolation
    include "PhysicsTools/IsolationAlgos/data/PhotonHCalIsolation.cfi"
    replace photonHCalIsolation.src = correctedPhotons
    replace photonHCalIsolation.dRMin = 0.0
    replace photonHCalIsolation.dRMax = 0.2
    replace photonHCalIsolation.elements = towerMaker

    #
    # GammaJetProducer
    #
    include "Calibration/GammaJetProducer/data/GammaJetProducer.cfi"
    replace GammaJetProducer.jetcollection    = iterativeCone5CaloJets
    replace GammaJetProducer.genjetcollection = iterativeCone5GenJets
    replace GammaJetProducer.photons = correctedPhotons
    replace GammaJetProducer.caliso  = photonCalIsolation
    replace GammaJetProducer.hcaliso = photonHCalIsolation
    replace GammaJetProducer.min_dR_photJet = 0.5
    #
    # GammaJetFilter
    #
    include "Calibration/GammaJetFilter/data/GammaJetFilter.cfi"
    replace GammaJetFilter.vertexProducer = offlinePrimaryVerticesFromCTFTracks
    replace GammaJetFilter.gencollection = genParticleCandidates
    #replace GammaJetFilter.gencollection = VtxSmeared
    replace GammaJetFilter.jetcollection = iterativeCone5CaloJets
    replace GammaJetFilter.genjetcollection = iterativeCone5GenJetsNoNu
    replace GammaJetFilter.photons = correctedPhotons
    replace GammaJetFilter.caliso = photonCalIsolation
    replace GammaJetFilter.hcaliso = photonHCalIsolation
    replace GammaJetFilter.caliso_threshold = 5.
    replace GammaJetFilter.hcaliso_threshold = 2.
    replace GammaJetFilter.ptout_threshold = 15.
    replace GammaJetFilter.min_pt_phot = 5.
    replace GammaJetFilter.max_eta_phot = 2.5
    replace GammaJetFilter.min_pt_jet = 2.
    replace GammaJetFilter.max_pt_jetSec = 15.
    replace GammaJetFilter.max_dPhi_photJet = 0.15
    #-----------------------------------------------------------------

    #
    # Run isolation tool on tracks with isolation against other tracks
    #
    include "PhysicsTools/IsolationAlgos/data/TrackTrackIsolation.cfi"
    replace TrackTrackIsolation.src      = ctfWithMaterialTracks
    replace TrackTrackIsolation.elements = ctfWithMaterialTracks
    replace TrackTrackIsolation.dRMin    = 0.2
    replace TrackTrackIsolation.dRMax    = 0.5

    #
    # Run isolation tool on CaloTowers with isolation against Cal
    #
    include "PhysicsTools/IsolationAlgos/data/CaloTowerCalIsolation.cfi"
    replace CaloTowerCalIsolation.src      = towerMaker
    replace CaloTowerCalIsolation.elements = towerMaker
    replace CaloTowerCalIsolation.dRMin    = 0.2
    replace CaloTowerCalIsolation.dRMax    = 0.5

    #
    # TrackTowerProducer
    #
    include "Calibration/TrackTowerProducer/data/TrackTowerProducer.cfi"
    replace TrackTowerProducer.Tracks            = ctfWithMaterialTracks
    replace TrackTowerProducer.Towers            = towerMaker
    replace TrackTowerProducer.TrackIsolation    = TrackTrackIsolation
    replace TrackTowerProducer.TowerIsolation    = CaloTowerCalIsolation
    replace TrackTowerProducer.TrackPtMin        = 2.
    replace TrackTowerProducer.TowerPtMin        = 2.
    replace TrackTowerProducer.EtaMin            = 2.5
    replace TrackTowerProducer.MaxTrackIsolation = 0.5
    replace TrackTowerProducer.MaxTowerIsolation = 0.5
    replace TrackTowerProducer.DeltaPhi          = 0.01
    replace TrackTowerProducer.DeltaEta          = 0.01

    #
    # TrackTowerFilter
    #
    include "Calibration/TrackTowerFilter/data/TrackTowerFilter.cfi"
    replace TrackTowerFilter.Track  = TrackTowerProducer:Track
    replace TrackTowerFilter.Tower  = TrackTowerProducer:Tower
    #-----------------------------------------------------------------
    #-----------------------------------------------------------------
    #Track/Cluster stuff:
    #
    # TrackClusterProducer
    #
    include "Calibration/TrackClusterProducer/data/TrackClusterProducer.cfi"
    replace TrackClusterProducer.Tracks            = ctfWithMaterialTracks
    replace TrackClusterProducer.Towers            = towerMaker
    replace TrackClusterProducer.TrackIsolation    = TrackTrackIsolation
    replace TrackClusterProducer.TrackPtMin        = 10.
    replace TrackClusterProducer.EtaMin            = 2.5
    replace TrackClusterProducer.MaxTrackIsolation = 2.0
    replace TrackClusterProducer.MaxTowerIsolation = 5.0
    replace TrackClusterProducer.OuterTowerIsoR    = 0.8
    replace TrackClusterProducer.InnerTowerIsoR    = 0.5

    #
    # TrackClusterFilter
    #
    #include "Calibration/TrackTowerFilter/data/TrackTowerFilter.cfi"
    #replace TrackTowerFilter.Track  = TrackTowerProducer:Track
    #replace TrackTowerFilter.Tower  = TrackTowerProducer:Tower
    #-----------------------------------------------------------------

    #-----------------------------------------------------------------
    # CalibTreeMaker for GammaJet
    #
    #include "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    module calibmaker_GammaJet = calibmaker from "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    replace calibmaker_GammaJet.jets    = GammaJetProducer:leadingCaloJet
    replace calibmaker_GammaJet.genjets = GammaJetProducer:leadingGenJet
    replace calibmaker_GammaJet.photon  = GammaJetProducer:leadingPhoton
    replace calibmaker_GammaJet.track   = TrackTowerProducer:Track
    replace calibmaker_GammaJet.tower   = TrackTowerProducer:Tower
    replace calibmaker_GammaJet.writeGammaJet   = true
    replace calibmaker_GammaJet.OutputFile = "gammaJet.root"

    #-----------------------------------------------------------------

    #-----------------------------------------------------------------
    # CalibTreeMaker for TrackTower
    #
    #include "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    module calibmaker_TrackTower = calibmaker from "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    replace calibmaker_TrackTower.jets    = GammaJetProducer:leadingCaloJet
    replace calibmaker_TrackTower.genjets = GammaJetProducer:leadingGenJet
    replace calibmaker_TrackTower.photon  = GammaJetProducer:leadingPhoton
    replace calibmaker_TrackTower.track   = TrackTowerProducer:Track
    replace calibmaker_TrackTower.tower   = TrackTowerProducer:Tower
    replace calibmaker_TrackTower.writeTrackTower = true
    replace calibmaker_TrackTower.OutputFile = "trackTower.root"
    #-----------------------------------------------------------------

    #-----------------------------------------------------------------
    # CalibTreeMaker for TrackCluster
    #
    #include "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    module  calibmaker_TrackCluster = calibmaker from "Calibration/CalibTreeMaker/data/CalibTreeMaker.cfi"
    replace calibmaker_TrackCluster.jets    = GammaJetProducer:leadingCaloJet
    replace calibmaker_TrackCluster.genjets = GammaJetProducer:leadingGenJet
    replace calibmaker_TrackCluster.photon  = GammaJetProducer:leadingPhoton
    replace calibmaker_TrackCluster.track   = TrackTowerProducer:Track
    replace calibmaker_TrackCluster.tower   = TrackTowerProducer:Tower
    replace calibmaker_TrackCluster.tc_track   = TrackClusterProducer:Track
    replace calibmaker_TrackCluster.tc_tower   = TrackClusterProducer:Towers
    replace calibmaker_TrackCluster.writeTrackCluster = true
    replace calibmaker_TrackCluster.OutputFile = "trackCluster.root"
    #-----------------------------------------------------------------

    sequence TrackTowerNeeded = { TrackTrackIsolation, CaloTowerCalIsolation, TrackTowerProducer }
    sequence GammaJetNeeded =   { photonCalIsolation, photonHCalIsolation, GammaJetProducer }
    sequence TrackClusterNeeded = { TrackTrackIsolation, TrackClusterProducer }

    #path TrackTower = { GammaJetNeeded, TrackTowerNeeded, TrackTowerFilter, calibmaker_TrackTower }
    #path GammaJet = { GammaJetNeeded, TrackTowerNeeded, GammaJetFilter, calibmaker_GammaJet }
    path TrackCluster = { TrackClusterNeeded, calibmaker_TrackCluster }

    #endpath p = {}
}

